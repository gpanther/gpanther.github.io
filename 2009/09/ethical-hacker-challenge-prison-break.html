<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Ethical Hacker challenge “Prison Break” solution - Grey Panther's Place</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="https://www.grey-panther.net/favicon.ico" rel="icon">
    <!--[if IE]><link rel="shortcut icon" href="https://www.grey-panther.net/favicon.ico"><![endif]-->

<link rel="canonical" href="https://www.grey-panther.net/2009/09/ethical-hacker-challenge-prison-break.html">

        <meta name="author" content="Attila-Mihaly Balazs" />
        <meta name="keywords" content="challenge,solution" />
        <meta name="description" content="As I usually do, I’ll publish my entry for the Ethical Hacker challenge after the deadline passed: Challenge Question 1: What is the most probable reason Michael could not get network connectivity from the desk Ethernet jack? What actions should the team take to determine exactly what is going ..." />

        <meta property="og:site_name" content="Grey Panther's Place" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Ethical Hacker challenge “Prison Break” solution"/>
        <meta property="og:url" content="https://www.grey-panther.net/2009/09/ethical-hacker-challenge-prison-break.html"/>
        <meta property="og:description" content="As I usually do, I’ll publish my entry for the Ethical Hacker challenge after the deadline passed: Challenge Question 1: What is the most probable reason Michael could not get network connectivity from the desk Ethernet jack? What actions should the team take to determine exactly what is going ..."/>
        <meta property="article:published_time" content="2009-09-02" />
            <meta property="article:section" content="archived" />
            <meta property="article:tag" content="challenge" />
            <meta property="article:tag" content="solution" />
            <meta property="article:author" content="Attila-Mihaly Balazs" />

    <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@cdman83">
        <meta name="twitter:creator" content="@cdman83">
    <meta name="twitter:domain" content="https://www.grey-panther.net">

    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://www.grey-panther.net/theme/css/bootstrap.superhero.min.css" type="text/css"/>
    <link href="https://www.grey-panther.net/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://www.grey-panther.net/theme/css/pygments/solarizeddark.css" rel="stylesheet">
        <link href="https://www.grey-panther.net/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="https://www.grey-panther.net/theme/css/style.css" type="text/css"/>

        <link href="https://www.grey-panther.net/feeds/posts/default" type="application/atom+xml" rel="alternate"
              title="Grey Panther's Place ATOM Feed"/>

        <link href="https://www.grey-panther.net/feeds/rss" type="application/rss+xml" rel="alternate"
              title="Grey Panther's Place RSS Feed"/>



</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://www.grey-panther.net/" class="navbar-brand">
Grey Panther's Place            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/">About</a></li>
                    <li><a href="/category/blog.html">Blog</a></li>
                    <li><a href="/pages/projects.html">Projects</a></li>
                    <li><a href="/pages/site-map.html">More</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="https://www.grey-panther.net/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://www.grey-panther.net/2009/09/ethical-hacker-challenge-prison-break.html"
                       rel="bookmark"
                       title="Permalink to Ethical Hacker challenge “Prison Break” solution">
                        Ethical Hacker challenge “Prison Break”&nbsp;solution
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2009-09-02T15:44:00+03:00"> Mi 02 septembrie 2009</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://www.grey-panther.net/tag/challenge.html">challenge</a>
        /
	<a href="https://www.grey-panther.net/tag/solution.html">solution</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>As I usually do, I’ll publish my entry for the <a href="http://hype-free.blogspot.com/2009/07/new-ethical-hacker-challenge.html">Ethical Hacker
challenge</a>
after the deadline&nbsp;passed:</p>
<p><em>Challenge Question 1</em>: What is the most probable reason Michael could
not get network connectivity from the desk Ethernet jack?  What actions
should the team take to determine exactly what is going on, collect full
traffic captures, and gain full access to the&nbsp;network?</p>
<p>Most probably the switch to which the given port is connected has <span class="caps">MAC</span>
address filtering turned on. To circumvent this, they must clone the <span class="caps">MAC</span>
address of the <span class="caps">VOIP</span>&nbsp;phone.</p>
<p>The easiest way to do this is to start capturing the traffic on the
network interface of the laptop and then plug the <span class="caps">VOIP</span> phone into it.
The initial packets (most probably <span class="caps">DHCP</span> requests) will reveal the phone
<span class="caps">MAC</span> address. Sidenote: most ethernet ports these days are auto-sensing
(ie. no crossover cable is required). But just to make sure, one should
use a crossover cable or an intermediate switch (not hub!) is one is
available. After the <span class="caps">MAC</span> address has been determined, the host <span class="caps">OS</span> should
be instructed to use the given <span class="caps">MAC</span> address for the laptop network card.
You can find instructions for Linux here:
<a href="http://linuxhelp.blogspot.com/2005/09/how-to-change-mac-address-of-your.html">http://linuxhelp.blogspot.com/2005/09/how-to-change-mac-address-of-your.html</a>
and for Windows here:
<a href="http://www.irongeek.com/i.php?page=security/changemac">http://www.irongeek.com/i.php?page=security/changemac</a></p>
<p>Sidenote: given that the packet captures show two distinct networks
(192.168.1.0/24 and 172.29.0.0/16), it is clear that the administrators
have tried to separate the computer networks from the <span class="caps">VOIP</span> one. However,
relying only on different (sub-)nets is extremely weak and at least <span class="caps">VLAN</span>
level separation should have been implemented (then again, maybe the
available switches don&#8217;t have <span class="caps">VLAN</span> features). 172.29.0.0/16 most
probably is the <span class="caps">VOIP</span> network, since we see <span class="caps">SIP</span> packets on it and
192.168.1.0/24 the computer&nbsp;network.</p>
<p>If only <span class="caps">MAC</span> filtering is implemented, after changing the <span class="caps">MAC</span> address, it
is possible to join any of the two available networks, meaning that they
can interact with the &#8220;computer&#8221; network, even if the given port was
originally assigned to a <span class="caps">VOIP</span>&nbsp;phone.</p>
<p><em>Challenge Question 2</em>: What tool should Lincoln download, if any, to be
able to capture traffic on the desktop&nbsp;computer?</p>
<p>Sectools.org contains a nice list of available packet sniffers (
<a href="http://sectools.org/sniffers.html">http://sectools.org/sniffers.html</a> ). Given the constraints, my tool of
choice would be WinDump, the Windows port of tcpdump (
<a href="http://www.winpcap.org/windump/install/">http://www.winpcap.org/windump/install/</a>&nbsp;)</p>
<p><em>Challenge Question 3</em>: Starting with the reverse connection from the
desktop computer, describe a step-by-step approach that could be applied
prior to 09:00 the next day in order to capture the network traffic on
the remote network and get a capture file for further in-depth analysis.
Make sure your approach follows Michael&#8217;s advice to avoid&nbsp;detection.</p>
<ul>
<li>download WinDump (
    <a href="http://www.winpcap.org/windump/install/bin/windump_3_9_5/WinDump.exe">http://www.winpcap.org/windump/install/bin/windump_3_9_5/WinDump.exe</a>
    ) and WinPcap to the&nbsp;laptop</li>
<li>use the instructions provided at the following link to construct a
    portable version of WinPcap:
    <a href="http://paperlined.org/apps/wireshark/winpcap_silent_install.html">http://paperlined.org/apps/wireshark/winpcap_silent_install.html</a></li>
<li>you can package up all the files (WinDump and the WinPcap DLLs +
    driver) into a single file using the <span class="caps">SFX</span> functionality from 7zip. To
    make sure that you don&#8217;t get under the 0.5 meg limit, use Zip with
    the Store&nbsp;algorithm</li>
<li>upload the resulting file to the general&#8217;s desktop (this part of the
    challenge is a little forced <span class="caps">IMHO</span>, since the <span class="caps">IDS</span> should have
    detected the reverse connection if it is sensible to long-lived, low
    traffic&nbsp;connections&#8230;)</li>
<li>launch the <span class="caps">SFX</span>, wait until all the files are extracted and copy
    npf.sys into&nbsp;c:\Windows\System32\drivers</li>
<li>
<p>before 9:00 <span class="caps">AM</span> (at 8:55 for example) launch WinDump (this will
    capture at most 5 <span class="caps">MB</span> of&nbsp;data):</p>
<div class="highlight"><pre><span></span>WinDump -i 1 -w capture.pcap -C 5
</pre></div>


</li>
<li>
<p>after WinDump has stopped, retrieve the capture file and clean up
    (delete the driver, the <span class="caps">SFX</span> file,&nbsp;etc)</p>
</li>
</ul>
<p><em>Challenge Question 4</em>: Help the team complete this aspect of their
mission by analyzing the packet capture file collected on the desktop
computer and provide detailed information about the environment. Your
response should at least include the type of network traffic collected,
details about the General’s laptop computer, details about the Scylla
Codes server plus any other server available, and provide the names and
contents of the files stored on the server the input passphrase is based&nbsp;on.</p>
<p>The collected traffic consists of 6 requests made to the Scylla server
(10.10.20.94) using <span class="caps">HTTPS</span>. To decode them, first convert the provided
key file into <span class="caps">PEM</span> format with&nbsp;OpenSSL:</p>
<p></p>
    openssl rsa -in server.key -out&nbsp;server_key.pem </p>
<p>Then use the resulting <span class="caps">PEM</span> file as described here for example to let
Wireshark decode the traffic:
<a href="http://www.novell.com/coolsolutions/appnote/19321.html">http://www.novell.com/coolsolutions/appnote/19321.html</a></p>
<p>Now you can use the &#8220;Follow <span class="caps">SSL</span> stream&#8221; functionality from Wireshark to
analyze each request. From the headers it seems that the general&#8217;s
laptop is running Windows Vista Media Center (tablet? edition), while
the Scylla server is running&nbsp;Linux/Apache:</p>
<p></p>
    User-Agent: Mozilla/4.0 (compatible; <span class="caps">MSIE</span> 7.0; Windows <span class="caps">NT</span> 6.0; <span class="caps">SLCC1</span>; .<span class="caps">NET</span> <span class="caps">CLR</span> 2.0.50727; Media Center <span class="caps">PC</span> 5.0; .<span class="caps">NET</span> <span class="caps">CLR</span> 3.0.04506) 
    Server: Apache/2.2.8 (Unix) mod_ssl/2.2.8 OpenSSL/0.9.8g <span class="caps">DAV</span>/2 <span class="caps">PHP</span>/5.2.9 </p>
<p></p>
<em>Challenge Question 5</em>: What are the validation code and input
passphrase used by the General to generate the Scylla validation code
for this&nbsp;week?</p>
<p>The validation code is&nbsp;&#8220;6189db841f01413a05a53b7135137a17&#8221;</p>
<p><em><span class="caps">BONUS</span> <span class="caps">QUESTION</span></em>: Briefly describe your recommendations about how The
Company could have detected and defended against the tactics you
described in your answer to Question&nbsp;3.</p>
<p>The attack could have been prevented by using a whitelisting product
which doesn&#8217;t let unknown executables be started. Other mitigating
measures would&nbsp;be:</p>
<ul>
<li>using Group Policy to disable&nbsp;autorun</li>
<li>using Group Policy to controls what kind of <span class="caps">USB</span> devices can be used:
    <a href="http://www.windowsecurity.com/articles/Control-USB-Devices-Group-Policy.html">http://www.windowsecurity.com/articles/Control-<span class="caps">USB</span>-Devices-Group-Policy.html</a></li>
<li>using a switched&nbsp;network</li>
<li>using an outbound proxy and make sure that only valid <span class="caps">HTTP</span>/<span class="caps">HTTPS</span>
    traffic can leave the&nbsp;network</li>
</ul>
<p>One could work around many of these restrictions (for example: finding a
vulnerability in an installed software, running meterpreter in-process,
killing the whitelisting software, masking the outbound connection as a
<span class="caps">HTTP</span> one, using <span class="caps">ARP</span> spoofing to get around the switched network, etc),
but it raises the bar&nbsp;considerably.</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="https://www.grey-panther.net/2009/09/network-forensics-contest-submission.html">Network Forensics Contest&nbsp;submission</a></li>
        <li><a href="https://www.grey-panther.net/2009/10/two-new-challenges.html">Two new&nbsp;challenges</a></li>
        <li><a href="https://www.grey-panther.net/2009/12/new-challenges.html">New&nbsp;challenges</a></li>
        <li><a href="https://www.grey-panther.net/2009/08/t2-challenge.html">T2&#8216;09&nbsp;Challenge</a></li>
        <li><a href="https://www.grey-panther.net/2010/01/announcing-couple-of-contests.html">Announcing a couple of&nbsp;contests</a></li>
    </ul>
</section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div id="aboutme">
        <p>
            <img width="60%" class="img" src="/images/profile.png"/>
        </p>
    <p>
        <strong>About Grey Panther</strong><br/>
        <a href="/">father, husband, software craftsman</a>
    </p>
</div>
<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://ro.linkedin.com/in/gpanther"><i class="fa fa-linkedin-square fa-lg"></i> linkedin</a></li>
                <li class="list-group-item"><a href="http://stackoverflow.com/users/1265/grey-panther"><i class="fa fa-stack-overflow fa-lg"></i> stackoverflow</a></li>
                <li class="list-group-item"><a href="https://github.com/gpanther/"><i class="fa fa-github-square fa-lg"></i> github</a></li>
              </ul>
            </li>





    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container-fluid">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 Grey Panther
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>              <p><small>  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://www.grey-panther.net/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://www.grey-panther.net/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://www.grey-panther.net/theme/js/respond.min.js"></script>


</body>
</html>