<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Putting the eval into Java - Grey Panther's Place</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="https://www.grey-panther.net/favicon.ico" rel="icon">
    <!--[if IE]><link rel="shortcut icon" href="https://www.grey-panther.net/favicon.ico"><![endif]-->

<link rel="canonical" href="https://www.grey-panther.net/2010/04/putting-eval-into-java.html">

        <meta name="author" content="Attila-Mihaly Balazs" />
        <meta name="keywords" content="programming,java" />
        <meta name="description" content="“eval” (short for evaluate) is usually the name given to the method in dynamic languages which makes it possible for the programmer to access the compiler / runtime. Here are a few links to the documentation for the function in different languages: Javascript Perl PHP Python Ruby LUA They are usually ..." />

        <meta property="og:site_name" content="Grey Panther's Place" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Putting the eval into Java"/>
        <meta property="og:url" content="https://www.grey-panther.net/2010/04/putting-eval-into-java.html"/>
        <meta property="og:description" content="“eval” (short for evaluate) is usually the name given to the method in dynamic languages which makes it possible for the programmer to access the compiler / runtime. Here are a few links to the documentation for the function in different languages: Javascript Perl PHP Python Ruby LUA They are usually ..."/>
        <meta property="article:published_time" content="2010-04-22" />
            <meta property="article:section" content="archived" />
            <meta property="article:tag" content="programming" />
            <meta property="article:tag" content="java" />
            <meta property="article:author" content="Attila-Mihaly Balazs" />

    <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@cdman83">
        <meta name="twitter:creator" content="@cdman83">
    <meta name="twitter:domain" content="https://www.grey-panther.net">

    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://www.grey-panther.net/theme/css/bootstrap.superhero.min.css" type="text/css"/>
    <link href="https://www.grey-panther.net/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://www.grey-panther.net/theme/css/pygments/solarizeddark.css" rel="stylesheet">
        <link href="https://www.grey-panther.net/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="https://www.grey-panther.net/theme/css/style.css" type="text/css"/>

        <link href="https://www.grey-panther.net/feeds/posts/default" type="application/atom+xml" rel="alternate"
              title="Grey Panther's Place ATOM Feed"/>

        <link href="https://www.grey-panther.net/feeds/rss" type="application/rss+xml" rel="alternate"
              title="Grey Panther's Place RSS Feed"/>



</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://www.grey-panther.net/" class="navbar-brand">
Grey Panther's Place            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/">About</a></li>
                    <li><a href="/category/blog.html">Blog</a></li>
                    <li><a href="/pages/projects.html">Projects</a></li>
                    <li><a href="/pages/site-map.html">More</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="https://www.grey-panther.net/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://www.grey-panther.net/2010/04/putting-eval-into-java.html"
                       rel="bookmark"
                       title="Permalink to Putting the eval into Java">
                        Putting the eval into&nbsp;Java
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2010-04-22T17:42:00+03:00"> Jo 22 aprilie 2010</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://www.grey-panther.net/tag/programming.html">programming</a>
        /
	<a href="https://www.grey-panther.net/tag/java.html">java</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><img alt="2254800793_185ccbdfa1_b" src="http://lh6.ggpht.com/_hrvCBhtWhJ4/S9BgS0EaV4I/AAAAAAAACP4/XNLXHNTtS9U/2254800793_185ccbdfa1_b%5B2%5D.jpg?imgmax=800" title="2254800793_185ccbdfa1_b" />
“eval” (short for evaluate) is usually the name given to the method in
dynamic languages which makes it possible for the programmer to access
the compiler / runtime. Here are a few links to the documentation for
the function in different&nbsp;languages:</p>
<ul>
<li><a href="https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Global_Functions/Eval">Javascript</a></li>
<li><a href="http://perldoc.perl.org/functions/eval.html">Perl</a></li>
<li><a href="http://php.net/manual/en/function.eval.php"><span class="caps">PHP</span></a></li>
<li><a href="http://docs.python.org/library/functions.html#eval">Python</a></li>
<li><a href="http://ruby-doc.org/core/classes/Kernel.html#M005922">Ruby</a></li>
<li><a href="http://www.lua.org/manual/5.1/manual.html#pdf-loadstring"><span class="caps">LUA</span></a></li>
</ul>
<p>They are usually used to quickly evaluate a <span class="caps">DSL</span> (Domain Specific
Language) expression. What I mean by this is the following: lets say
that the user supplies an expression which can be easily (ie. with a few
string replacements or regular expressions at most) converted into a
valid expression in the current language. Then you don’t have to write
your own lexer / parser / runtime to support this&nbsp;function.</p>
<p>To make this example even more concrete, lets say that you are
implementing a simple graphing calculator where the user can supply the
right part of the f(x)=&#8230; expression and you draw the function for a
given interval of x. If the user supplies something like 1 + 2*x +
3*x*x, this is pretty much a valid expression in all programming
languages (there are minor syntactic differences to be precise - like
Perl/<span class="caps">PHP</span> requiring you to prefix variable names by the “\$” sign), so
you could simply use “eval” on&nbsp;it.</p>
<p><strong><u>Warning! Running eval on unverified, user supplied code is a
really, really bad idea! (yes, I know that red and bold underline is a
little over the top, but this is just that bad! Never, never, ever do
this! It is equivalent to letting everybody connected to the Internet
(assuming that we are talking about an webapp) running arbitrary code on
your server. Implement very strict filtering (based on whitelisting if
at all possible) for such features!</u></strong></p>
<p>Surely, you would say, such a dynamic feature isn’t easily accessible
for a statically typed compiled language as Java&#8230; And you would be
wrong! As of Java 6 each <span class="caps">JVM</span> install (including the JREs) includes the
Java compiler, and it also includes <a href="http://java.sun.com/javase/6/docs/api/javax/tools/JavaCompiler.html">a public <span class="caps">API</span> to access
it</a>.
Using this feature you can implement the Java equivalent of “eval”:
giving a string to the compiler and getting a class instance back, on
which you can call methods. You can find the source <a href="http://code.google.com/p/hype-free/source/browse/trunk/java-dyncompile/src/com/hypefree/blogspot/dyncompile/DynCompile.java">in my <span class="caps">SVN</span>
repo</a>.
It is (almost entirely) based on the following article from 2007 (just
to give you an idea how long this option has been around): <a href="http://www.ibm.com/developerworks/java/library/j-jcomp/index.html">Create
dynamic applications with
javax.tools</a>.
An other (pleasant) surprise was the fact that this process doesn’t
require any security privileges and works perfectly in restricted
environments such as&nbsp;browser.</p>
<p>An additional advantage of using the <span class="caps">JVM</span> rather than your own runtime is
speed: many man-hours have gone into optimizing both the source –>
bytecode and the bytecode –> machine code transformations. Which brings
me to an other possible use for this kind of solution: generating
particularized instances of generic classes to give more hints to the
<span class="caps">JVM</span> about possible&nbsp;implementations.</p>
<p>For example, the StrinkTokenizer class does the following when looking
for separator&nbsp;characters:</p>
<div class="highlight"><pre><span></span>char c = str.charAt(position);
if ((c &gt; maxDelimCodePoint) || (delimiters.indexOf(c) &lt; 0))
    break;
</pre></div>


<p></code></p>
<p>Now imagine how much more efficient (in the sense of: easier for the <span class="caps">JVM</span>
to translate into an efficient machinecode) this code would be if we
knew that we have exactly one possible delimiter (as it is the case most
of the time). Replacing <code>delimiters.indexOf(c)</code> with <code>delimiter == c</code>
can give you an order of magnitude speedup for this particular&nbsp;code.</p>
<p>The takeaway should&nbsp;be:</p>
<ul>
<li>This is a very powerful technique, but it should be used with care!
    Only use this method if you’ve proven (by using a profiler for
    example) that the given class is the dominant factor in the
    performance&nbsp;picture.</li>
<li>Be particularly aware of potential security risks which could&nbsp;appear!</li>
<li>Also, be aware that you give up many things when going this route:<ul>
<li>Automated&nbsp;refactoring</li>
<li>Reports generated by bytecode analysis tools (like coverage or
    bug&nbsp;detection)</li>
<li>Debugger&nbsp;support</li>
</ul>
</li>
<li>In conclusion: use it with great care, but if used properly, it can
    result in considerable performance&nbsp;improvements!</li>
</ul>
<p><em>Picture taken from</em> <a href="http://www.flickr.com/photos/hexadecimal_time/"><em>Hexadecimal Time&#8217;s
photostream</em></a> <em>with&nbsp;permission.</em></p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="https://www.grey-panther.net/2011/02/is-hand-writing-assembly-still.html">Is hand-writing assembly still necessary these&nbsp;days?</a></li>
        <li><a href="https://www.grey-panther.net/2010/03/performance-optimization-techniques-for.html">Performance optimization techniques for Java&nbsp;code</a></li>
        <li><a href="https://www.grey-panther.net/2011/01/java-date-objects-can-mutate-even-when.html">Java Date objects can mutate, even when&nbsp;read</a></li>
        <li><a href="https://www.grey-panther.net/2010/03/stringintern-there-are-better-ways.html">String.intern() – there are better&nbsp;ways</a></li>
        <li><a href="https://www.grey-panther.net/2011/01/java-has-some-surprising-amount-of.html">Java has some surprising amount of dinamism in&nbsp;it</a></li>
    </ul>
</section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div id="aboutme">
        <p>
            <img width="60%" class="img" src="/images/profile.png"/>
        </p>
    <p>
        <strong>About Grey Panther</strong><br/>
        <a href="/">father, husband, software craftsman</a>
    </p>
</div>
<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://ro.linkedin.com/in/gpanther"><i class="fa fa-linkedin-square fa-lg"></i> linkedin</a></li>
                <li class="list-group-item"><a href="http://stackoverflow.com/users/1265/grey-panther"><i class="fa fa-stack-overflow fa-lg"></i> stackoverflow</a></li>
                <li class="list-group-item"><a href="https://github.com/gpanther/"><i class="fa fa-github-square fa-lg"></i> github</a></li>
              </ul>
            </li>





    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container-fluid">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 Grey Panther
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>              <p><small>  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://www.grey-panther.net/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://www.grey-panther.net/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://www.grey-panther.net/theme/js/respond.min.js"></script>


</body>
</html>