<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Writing beautiful code - not just for the aesthetic value - Grey Panther's Place</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="https://www.grey-panther.net/favicon.ico" rel="icon">
    <!--[if IE]><link rel="shortcut icon" href="https://www.grey-panther.net/favicon.ico"><![endif]-->

<link rel="canonical" href="https://www.grey-panther.net/2012/11/writing-beautiful-code-not-just-for.html">

        <meta name="author" content="Attila-Mihaly Balazs" />
        <meta name="description" content="This article was originally published in the 6th edition of TodaySoftMag in Romanian and on the Transylvania JUG blog in English. Reprinted here with the permission of the author / magazine. Most mainstream programming languages contain a large set of features and diverse standard libraries. Because of this it becomes important ..." />

        <meta property="og:site_name" content="Grey Panther's Place" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Writing beautiful code - not just for the aesthetic value"/>
        <meta property="og:url" content="https://www.grey-panther.net/2012/11/writing-beautiful-code-not-just-for.html"/>
        <meta property="og:description" content="This article was originally published in the 6th edition of TodaySoftMag in Romanian and on the Transylvania JUG blog in English. Reprinted here with the permission of the author / magazine. Most mainstream programming languages contain a large set of features and diverse standard libraries. Because of this it becomes important ..."/>
        <meta property="article:published_time" content="2012-11-06" />
            <meta property="article:section" content="archived" />
            <meta property="article:author" content="Attila-Mihaly Balazs" />

    <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@cdman83">
        <meta name="twitter:creator" content="@cdman83">
    <meta name="twitter:domain" content="https://www.grey-panther.net">

    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://www.grey-panther.net/theme/css/bootstrap.superhero.min.css" type="text/css"/>
    <link href="https://www.grey-panther.net/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://www.grey-panther.net/theme/css/pygments/solarizeddark.css" rel="stylesheet">
        <link href="https://www.grey-panther.net/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="https://www.grey-panther.net/theme/css/style.css" type="text/css"/>

        <link href="https://www.grey-panther.net/feeds/posts/default" type="application/atom+xml" rel="alternate"
              title="Grey Panther's Place ATOM Feed"/>

        <link href="https://www.grey-panther.net/feeds/rss" type="application/rss+xml" rel="alternate"
              title="Grey Panther's Place RSS Feed"/>



</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://www.grey-panther.net/" class="navbar-brand">
Grey Panther's Place            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/">About</a></li>
                    <li><a href="/category/blog.html">Blog</a></li>
                    <li><a href="/pages/projects.html">Projects</a></li>
                    <li><a href="/pages/site-map.html">More</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="https://www.grey-panther.net/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://www.grey-panther.net/2012/11/writing-beautiful-code-not-just-for.html"
                       rel="bookmark"
                       title="Permalink to Writing beautiful code - not just for the aesthetic value">
                        Writing beautiful code - not just for the aesthetic&nbsp;value
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2012-11-06T14:33:00+02:00"> Ma 06 noiembrie 2012</time>
    </span>





    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><em>This article was originally published in <a href="http://www.todaysoftmag.com/article/ro/6/A_scrie_cod_frumos_-_dincolo_de_valoarea_estetica_159">the 6th edition of
TodaySoftMag in
Romanian</a>
and on the <a href="http://www.transylvania-jug.org/archives/5477">Transylvania <span class="caps">JUG</span> blog in
English</a>. Reprinted here
with the permission of the author /&nbsp;magazine.</em></p>
<p>
<center>
<iframe src="https://docs.google.com/presentation/embed?id=1fC4qeDc4zkKGaLZBMrRdgmRMuoDw4KeYmmJAZvVVFLY&amp;start=false&amp;loop=false&amp;delayms=3000" frameborder="0" width="480" height="389" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true">
</iframe>
</center>
</p>

<p>Most mainstream programming languages contain a large set of features
and diverse standard libraries. Because of this it becomes important to
know not only “how” you can achieve something (to which there are
usually several answers) but also “what is the recommended&nbsp;way”.</p>
<p>In this article I will argue that knowing and following the recommended
ways of coding doesn’t only yield shorter (easier to write), easier to
read, understand and maintain code but also prevents programmers from
introducing a lot of&nbsp;bugs.</p>
<p>This particular article needs a drop of Java language knowledge to
savour, but the fundamental idea can be generalized to any programming
language: there is more to using a language efficiently than just
knowing the&nbsp;syntax.</p>
<h2><span id="h.71vcwrw1xmys"></span></a>Example 1: Double&nbsp;Trouble</h2>
<p>Lets start with a snippet of code: what does it print&nbsp;out?</p>
<div class="highlight"><pre>Double d1 = (5.0d - 5.0d) *  1.0d;
Double d2 = (5.0d - 5.0d) * -1.0d;
System.out.println(d1.equals(d2));
</pre></div>


<p></code></p>
<p>What about the following&nbsp;one?</p>
<div class="highlight"><pre>double d1 = (5.0d - 5.0d) *  1.0d;
double d2 = (5.0d - 5.0d) * -1.0d;
System.out.println(d1 == d2);
</pre></div>


<p></code></p>
<p>The answer seems to be clear: in both cases we multiply zero with
different values (plus and minus one respectively), thus the result
should be zero which should compare as equal regardless of the
comparison method used (calling the equals method on objects or using
the equality operator on the primitive&nbsp;values).</p>
<p>If we run the code, the result might surprise us: the first one displays
false while the second one displays true. What’s going on? On one level
we can talk the technical reasons behind this result: floating point
values are represented in Java (and many other programming languages)
using the sign-and-magnitude notation defined in the <span class="caps">IEEE</span> Standard 754.
Because of this technical detail both “plus zero” and “minus zero” can
be represented by variables of this type. And the “equals” method on
Double (and Float) objects in Java considers these values to be&nbsp;distinct.</p>
<p>On another level however we could have avoided this problem entirely by
using the primitive values as shown in the second code snippet and as
suggested by Item 49 in the Effective Java book^<span
id="ftnt_ref1"><a href="#ftnt1">[1]</a></span>^: Prefer primitive types to boxed
primitives. Using primitive types is also more memory efficient and
saves us from having to create special cases for the null&nbsp;value.</p>
<p>Sidenote: we have a similar situation with the BigDecimal class^<span
id="ftnt_ref2"><a href="#ftnt2">[2]</a></span>^ where values scaled differently
don’t compare as equal. For example the following snippet also prints&nbsp;false:</p>
<div class="highlight"><pre>BigDecimal d1 = new BigDecimal(&quot;1.2&quot;);
BigDecimal d2 = new BigDecimal(&quot;1.20&quot;);
System.out.println(d1.equals(d2));
</pre></div>


<p></code></p>
<p>The answer in this case (given that there is no primitive equivalent for
this class) would be to use the compareTo method and assert that it
returns zero instead of using the equals method (a method which can also
be used to solve the conundrum in the Double/Float case if we are not
worried about&nbsp;nulls).</p>
<h2><span id="h.t3ulkiuv7mcw"></span></a>Example 2: Where is my null&nbsp;at?</h2>
<p>What does the following snippet of code print&nbsp;out?</p>
<div class="highlight"><pre>Double v = null;
Double d = true ? v : 0.0d;
System.out.println(d);
</pre></div>


<p></code></p>
<p>At first glance we would say: null, since the condition is true and v is
null (and null can be assigned to a reference of any type, so we are
allowed to use it). The actual result is however a NullPointerException
at the second line. This is because the right-hand type of the
assignment is actually double (the primitive type) not Double (as we
would expect) which is silently converted into Double (the boxed type).
The generated code looks like&nbsp;this:</p>
<div class="highlight"><pre>Double d = Double.valueOf(true ? v.doubleValue() : 0.0d);
</pre></div>


<p></code></p>
<p>This behavior is described in the Java Language Specification^<span
id="ftnt_ref3"><a href="#ftnt3">[3]</a></span>^:</p>
<p>“If one of the second and third operands is of primitive type T, and the
type of the other is the result of applying boxing conversion (§5.1.7)
to T, then the type of the conditional expression is&nbsp;T.”</p>
<p>I would venture to guess that not many of us have read the <span class="caps">JLS</span> in its
entirety and even if we would have read it, we might not have realized
the implications of each phrase. The recommendation from EJ2nd mentioned
at the previous example saves us again: we should use primitive types.
We can also draw a parallel with Item 43: Return empty arrays or
collections, not nulls. Would we have used a “neutral element”, which is
analogous to using empty arrays/collections, the problem would not have
appeared. (The neutral element would be 0.0d if we use the value later
in summation or 1.0d if we use it in&nbsp;multiplication.)</p>
<h2><span id="h.1mt6ca4376w9"></span></a>Example 3: We come up&nbsp;empty</h2>
<p>What is the difference between the following two&nbsp;conditions?</p>
<div class="highlight"><pre>Collection items;
if (items.size() == 0) { ... }
if (items.isEmpty()) { ... }
</pre></div>


<p></code></p>
<p>One could argue that they do exactly the same thing as being empty is
equivalent to having zero items. Still, the second condition is easier
to understand (we can almost read it out loud: “if items is empty then
…”). But there is more: in some cases it can be much, much faster. Two
examples from the Java standard libraries where the time needed to
execute “size” grows linearly with the number of elements in the
collection while “isEmpty” returns in constant time:
ConcurrentLinkedQueue^<span id="ftnt_ref4"><a href="#ftnt4">[4]</a></span>^ and the
view sets returned by TreeSet’s^<span
id="ftnt_ref5"><a href="#ftnt5">[5]</a></span>^ headSet/tailSet methods. And while
the documentation for the first mentions this fact, it doesn’t for the&nbsp;second.</p>
<p>This is yet another example how nicer code is also&nbsp;faster.</p>
<h2><span id="h.orqngpa6ggt9"></span></a>Example 4: Careful with that static,&nbsp;Eugene!</h2>
<p>What will the following snippet of code print&nbsp;out?</p>
<div class="highlight"><pre>public final class Test {
        private static final class Foo {
                static final Foo INSTANCE = new Foo(); // 2
                static final String NAME = Foo.class.getName(); // 3
                Foo() {
                        System.err.println(&quot;Hello, my name is &quot; + NAME);
                }
        }
        public static void main(String[] args) {
                System.err.println(&quot;Your name is what?\nYour name is who?\n&quot;);
                new Foo(); // 1
        }
}
</pre></div>


<p></code></p>
<p>It will&nbsp;be</p>
<div class="highlight"><pre><span class="x">Your name is what?</span>
<span class="x">Your name is who?</span>

<span class="x">Hello, my name is null</span>
<span class="x">Hello, my name is Test</span><span class="p">$</span><span class="nv">Foo</span><span class="x"></span>
</pre></div>


<p></code></p>
<p>The (probably) unexpected null value happens because we obtain a
reference to a partially constructed&nbsp;object:</p>
<ul>
<li>We start to create an instance of Foo at point&nbsp;1</li>
<li>This being the first reference to Foo, the <span class="caps">JVM</span> loads it and starts
    to initialize&nbsp;it</li>
<li>Initializing Foo involves initializing all its static&nbsp;fields</li>
<li>The initialization of the first static field contains a call to the
    constructor at point 2 which is dutifully&nbsp;executed</li>
<li>At this point the <span class="caps">NAME</span> static field is not yet initialized, so the
    constructor will print out&nbsp;null</li>
</ul>
<p>This code demonstrates that static fields can be confusing and we
shouldn’t use them for things other than constants (but even then we
should evaluate if the constant is not better declared as an Enum). By
the same token we should also avoid singletons which make our code
harder to test (thus avoiding them will make the code easier to&nbsp;test).</p>
<p>We should however favor static member classes over non-static ones (Item
22 in EJ2nd). Static classes in Java are entirely distinct conceptually
from static fields and it is unfortunate that the same word was used to
describe them&nbsp;both.</p>
<p>We should also run static analysis tools on our code and verify their
output frequently (ideally at every commit). For example the bug
presented is caught by Findbugs^<span
id="ftnt_ref6"><a href="#ftnt6">[6]</a></span>^ and tools incorporating&nbsp;Findbugs.</p>
<h2><span id="h.26ynxgfuhslr"></span></a>Example 5: Remove old&nbsp;cruft</h2>
<p>Name four things wrong with the following&nbsp;snippet:</p>
<div class="highlight"><pre>// WRONG! DON’T DO THIS!
Vector v1;
...
if (!v1.contains(s)) { v1.add(s); }
</pre></div>


<p></code></p>
<p>They would&nbsp;be:</p>
<ul>
<li>The wrong container type is used. We clearly want to have each
    string present at most once which suggests using a&nbsp;Set</li>
<li>which has the benefits of shorter and faster code (the above method
    gets linearly slower with the number of&nbsp;elements)</li>
<li>Doesn’t use&nbsp;generics</li>
<li>It unnecessarily synchronizes access to the structure if it is only
    used from a single&nbsp;thread</li>
<li>If the structure is actually used from multiple threads, the code is
    not thread safe, only “exception safe” (as in: no exceptions will be
    raised, but the data structure can be silently corrupted possibly
    creating a lot of headache&nbsp;downstream)</li>
</ul>
<p>All of these can be avoided by dropping Vector and its siblings
(Hashtable, StringBuffer) and using the Java Collection Framework
(available for 14 years^<span id="ftnt_ref7"><a href="#ftnt7">[7]</a></span>^) with
generics (available for 8 years^<span
id="ftnt_ref8"><a href="#ftnt8">[8]</a></span>^).</p>
<h2><span id="h.t7tt7vdn4ji9"></span></a>Conclusion</h2>
<p>There are many more examples one could give, but I think the point is
well made that knowing a programming language means more than just
knowing the syntax at a basic level. I’m urging you if you are using
Java: get yourself a copy “Effective Java, 2nd edition” and “Java™
Puzzlers: Traps, Pitfalls, and Corner Cases” each and read through them
if you haven’t done so already. Also, use static analysis on your code
(Sonar^<span id="ftnt_ref9"><a href="#ftnt9">[9]</a></span>^ is a good choice in
this domain) and consider fixing the issues signaled by it, or at least
read up on&nbsp;them.</p>
<p>Again, the conclusions is similar for other&nbsp;languages:</p>
<ul>
<li>Try reading up on best practices/idiomatic ways to write code in the
    given language. For example for Perl the best book currently is
    “Modern Perl^<span id="ftnt_ref10"><a href="#ftnt10">[10]</a></span>^” by&nbsp;chromatic</li>
<li>Look to see if there is a good quality static analysis / lint
    program for your language. For Perl there is Perl::Critic^<span
    id="ftnt_ref11"><a href="#ftnt11">[11]</a></span>^, for Python there is
    pep8^<span id="ftnt_ref12"><a href="#ftnt12">[12]</a></span>^ and pylint^<span
    id="ftnt_ref13"><a href="#ftnt13">[13]</a></span>^, all of which are free and
    open&nbsp;source</li>
</ul>
<p>Being good a programmer (or an architect, or a business analyst, etc) is
process of lifelong learning and these are the tools which can help us
truly learn a programming&nbsp;language.</p>
<hr />
<div>

<span id="ftnt1">[[1]](#ftnt_ref1)</span>Joshua Bloch: Effective Java,
Second Edition. <span class="caps">ISBN</span>: 0321356683

</div>

<div>

<span
id="ftnt2">[[2]](#ftnt_ref2)</span><http://docs.oracle.com/javase/7/docs/api/java/math/BigDecimal.html>

</div>

<div>

<span
id="ftnt3">[[3]](#ftnt_ref3)</span><http://docs.oracle.com/javase/specs/jls/se7/html/jls-15.html#jls-15.25>

</div>

<div>

<span
id="ftnt4">[[4]](#ftnt_ref4)</span><http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ConcurrentLinkedQueue.html#size()>

</div>

<div>

<span
id="ftnt5">[[5]](#ftnt_ref5)</span><http://docs.oracle.com/javase/7/docs/api/java/util/TreeSet.html>

</div>

<div>

<span
id="ftnt6">[[6]](#ftnt_ref6)</span><http://findbugs.sourceforge.net/bugDescriptions.html#SI_INSTANCE_BEFORE_FINALS_ASSIGNED>

</div>

<div>

<span
id="ftnt7">[[7]](#ftnt_ref7)</span><http://en.wikipedia.org/wiki/Java_version_history#J2SE_1.2_.28December_8.2C_1998.29>

</div>

<div>

<span
id="ftnt8">[[8]](#ftnt_ref8)</span><http://en.wikipedia.org/wiki/Java_version_history#J2SE_5.0_.28September_30.2C_2004.29>

</div>

<div>

<span id="ftnt9">[[9]](#ftnt_ref9)</span><http://www.sonarsource.org/>

</div>

<div>

<span
id="ftnt10">[[10]](#ftnt_ref10)</span><http://www.onyxneon.com/books/modern_perl/index.html>

</div>

<div>

<span
id="ftnt11">[[11]](#ftnt_ref11)</span><http://search.cpan.org/~thaljef/Perl-Critic-1.118/lib/Perl/Critic.pm>

</div>

<div>

<span
id="ftnt12">[[12]](#ftnt_ref12)</span><http://pypi.python.org/pypi/pep8>

</div>

<div>

<span
id="ftnt13">[[13]](#ftnt_ref13)</span><http://pypi.python.org/pypi/pylint>

</div>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div id="aboutme">
        <p>
            <img width="60%" class="img" src="/images/profile.png"/>
        </p>
    <p>
        <strong>About Grey Panther</strong><br/>
        <a href="/">father, husband, software craftsman</a>
    </p>
</div>
<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://ro.linkedin.com/in/gpanther"><i class="fa fa-linkedin-square fa-lg"></i> linkedin</a></li>
                <li class="list-group-item"><a href="http://stackoverflow.com/users/1265/grey-panther"><i class="fa fa-stack-overflow fa-lg"></i> stackoverflow</a></li>
                <li class="list-group-item"><a href="https://github.com/gpanther/"><i class="fa fa-github-square fa-lg"></i> github</a></li>
              </ul>
            </li>





    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container-fluid">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 Grey Panther
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>              <p><small>  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://www.grey-panther.net/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://www.grey-panther.net/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://www.grey-panther.net/theme/js/respond.min.js"></script>


</body>
</html>